<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Math Stats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="DataInputPage.css">
</head>

<body>
    <div class="page-content">
    <div class="title">MATH STATS</div>

    
    <div class="card">

        <img src="skull.png" class="skull left" alt="skull">
        <img src="skull2.png" class="skull right" alt="skull">

        <div class="section-title">ðŸ“Š Data Input</div>

        <label for="intervalInput">Intervals (Optional)</label>
        <input id="intervalInput" type="text" placeholder="Enter intervals separated by commas">
        <div class="note">
            Leave empty for ungrouped data, or enter intervals separated by commas
        </div>

        <label>Data & Frequency</label>
        <div id="entriesContainer">
            <div class="row">
                <input class="data-input" type="text" placeholder="Data">
                <input class="freq-input" type="text" placeholder="Frequency">
                <button type="button" class="delete-btn">âœ•</button>
            </div>
        </div>

        <div class="button-row">
            <button id="addBtn" type="button" class="add-btn">+ Add Entry</button>
            <button id="calcBtn" type="button" class="calc-btn">Calculate</button>
            <button id="clearBtn" type="button" class="clear-btn">Clear</button>
        </div>

    </div>
    </div>

    <div class="tutorial-overlay" id="tutorialOverlay" aria-hidden="true">
        <div class="tutorial-scene" aria-hidden="true">
            <div class="hud-grid"></div>
            <div class="hud-circuit"></div>
            <div class="hud-center">
                <div class="ring ring-outer"></div>
                <div class="ring ring-mid"></div>
                <div class="ring ring-mid-2"></div>
                <div class="ring ring-inner"></div>
                <div class="ring ring-core"></div>
                <div class="hud-dots"></div>
                <div class="hud-crosshair"></div>
            </div>
        </div>
        <img src="Kuromi_render.png" class="kuromi-character" alt="Kuromi character">
        <button type="button" class="skip-btn" id="skipTutorialBtn">Skip</button>
    </div>

    <script>
        const entriesContainer = document.getElementById("entriesContainer");
        const addBtn = document.getElementById("addBtn");
        const clearBtn = document.getElementById("clearBtn");
        const calcBtn = document.getElementById("calcBtn");
        const intervalInput = document.getElementById("intervalInput");
        const tutorialOverlay = document.getElementById("tutorialOverlay");
        const skipTutorialBtn = document.getElementById("skipTutorialBtn");

        const tutorialStartDelayMs = 500;
        const hudIntroDurationMs = 1000;
        const hudShrinkDurationMs = 2000;
        const tutorialOutroDurationMs = 350;
        let phaseSmallTimerId;
        let phaseLeftTimerId;

        document.body.classList.add("tutorial-open");
        window.setTimeout(() => {
            tutorialOverlay.classList.add("is-active");
            tutorialOverlay.setAttribute("aria-hidden", "false");
            phaseSmallTimerId = window.setTimeout(() => {
                if (!tutorialOverlay.classList.contains("is-active")) return;
                tutorialOverlay.classList.add("phase-small");
            }, hudIntroDurationMs);
            phaseLeftTimerId = window.setTimeout(() => {
                if (!tutorialOverlay.classList.contains("is-active")) return;
                tutorialOverlay.classList.add("phase-left");
            }, hudIntroDurationMs + hudShrinkDurationMs);
        }, tutorialStartDelayMs);

        function createRow() {
            const row = document.createElement("div");
            row.className = "row";
            row.innerHTML = `
                <input class="data-input" type="text" placeholder="Data">
                <input class="freq-input" type="text" placeholder="Frequency">
                <button type="button" class="delete-btn">âœ•</button>
            `;
            return row;
        }

        function getRows() {
            return [...entriesContainer.querySelectorAll(".row")];
        }

        function clearRowsToSingleBlank() {
            entriesContainer.innerHTML = "";
            entriesContainer.appendChild(createRow());
        }

        addBtn.addEventListener("click", () => {
            const newRow = createRow();
            entriesContainer.appendChild(newRow);
            newRow.scrollIntoView({ behavior: "smooth", block: "start" });
        });

        entriesContainer.addEventListener("click", (event) => {
            const target = event.target;
            if (!target.classList.contains("delete-btn")) return;
            const rows = getRows();
            if (rows.length === 1) {
                rows[0].querySelector(".data-input").value = "";
                rows[0].querySelector(".freq-input").value = "";
                return;
            }
            target.closest(".row").remove();
        });

        clearBtn.addEventListener("click", () => {
            intervalInput.value = "";
            clearRowsToSingleBlank();
        });

        calcBtn.addEventListener("click", () => {
            const rows = getRows();
            const parsed = [];

            for (let i = 0; i < rows.length; i += 1) {
                const dataValue = rows[i].querySelector(".data-input").value.trim();
                const freqValue = rows[i].querySelector(".freq-input").value.trim();
                if (!dataValue && !freqValue) continue;

                const x = Number(dataValue);
                const f = Number(freqValue);
                if (!Number.isFinite(x) || !Number.isFinite(f) || f < 0) {
                    alert(`Invalid values on row ${i + 1}. Use numeric data and non-negative frequency.`);
                    return;
                }
                parsed.push({ x, f });
            }

            if (parsed.length === 0) {
                alert("Add at least one valid data and frequency pair.");
                return;
            }

            const intervals = intervalInput.value
                .split(",")
                .map((s) => s.trim())
                .filter(Boolean);

            if (intervals.length > 0 && intervals.length !== parsed.length) {
                alert("If intervals are provided, they must match the number of data/frequency rows.");
                return;
            }

            const totalFrequency = parsed.reduce((sum, row) => sum + row.f, 0);
            if (totalFrequency === 0) {
                alert("Total frequency cannot be zero.");
                return;
            }

            const sumFX = parsed.reduce((sum, row) => sum + (row.x * row.f), 0);
            const mean = sumFX / totalFrequency;

            alert(
                `Entries: ${parsed.length}\n` +
                `Total Frequency (Î£f): ${totalFrequency}\n` +
                `Sum of f*x (Î£fx): ${sumFX}\n` +
                `Mean: ${mean.toFixed(4)}`
            );
        });

        skipTutorialBtn.addEventListener("click", () => {
            if (!tutorialOverlay.classList.contains("is-active")) return;
            if (phaseSmallTimerId) window.clearTimeout(phaseSmallTimerId);
            if (phaseLeftTimerId) window.clearTimeout(phaseLeftTimerId);
            tutorialOverlay.classList.add("is-exiting");
            tutorialOverlay.setAttribute("aria-hidden", "true");
            window.setTimeout(() => {
                tutorialOverlay.classList.remove("is-active", "is-exiting", "phase-small", "phase-left");
                document.body.classList.remove("tutorial-open");
            }, tutorialOutroDurationMs);
        });
    </script>

</body>
</html>
